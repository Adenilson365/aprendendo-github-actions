name: CI/CD Fake
on: 
    pull_request:  
jobs:
    CI:
        runs-on: ubuntu-latest
        permissions:
          pull-requests: write
          issues: write
        steps:
            - name: Checkout do c칩digo
              uses: actions/checkout@v4
            - name: criar arquivo
              run: |
                echo "# module.eks.aws_iam_role.node_iam will be created" >> plan.txt
                echo "# module.eks.aws_iam_role.node_iam will be created" >> plan.txt
            - name: Comentar PR
              uses: actions/github-script@v7
              with:
                script: |
                  const { execSync } = require('child_process');

                  function runCommand(command) {
                    try {
                      return execSync(command, { encoding: 'utf-8' }).trim();
                    } catch {
                      return '';
                    }
                  }

                  const planResumo = "Resumo do plano";
                  const planDetails = runCommand('cat plan.txt | grep "Plan:"') || "Nenhuma informa칞칚o encontrada";
                  
                  const destroyResources = runCommand('cat plan.txt | grep "will be destroyed"') || "Nenhum recurso ser치 destru칤do";
                  const modifyResources = runCommand('cat plan.txt | grep "will be changed"') || "Nenhum recurso ser치 alterado";
                  const createResources = runCommand('cat plan.txt | grep "will be created"') || "Nenhum recurso ser치 criado";

                  const separator = "====================================================================================================";

                  const commentBody = `游녦 Thanks for reporting!\n
                  ${planResumo}\n
                  ${planDetails}\n
                  ${separator}\n
                  Recursos a serem destru칤dos\n
                  ${destroyResources}\n
                  ${separator}\n
                  Recursos a serem modificados\n
                  ${modifyResources}\n
                  ${separator}\n
                  Recursos a serem criados\n
                  ${createResources}`;

                  github.rest.issues.createComment({
                    issue_number: context.issue.number,
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    body: commentBody
                  });